(function(){var a,b,c,d=[].slice,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};b=window.Suki,a=window.Suki={},a.noConflict=function(){return window.Suki=b,this},a.trigger=function(){var b,c;return b=1<=arguments.length?d.call(arguments,0):[],(c=a.Event).triggerAll.apply(c,b)},a.Base=function(){function b(){}return b.include=function(a){var b,c,d,f;d=a.prototype;for(b in d)e.call(d,b)&&(c=d[b],"constructor"!==b&&(this.prototype[b]=c));return null!=(f=a.included)?f.apply(this):void 0},b.getter=function(a,b){return Object.defineProperty(this.prototype,a,{get:b,configurable:!0})},b.setter=function(a,b){return Object.defineProperty(this.prototype,a,{set:b,configurable:!0})},b.prototype.UUID=function(){return a.Base.UUID||(a.Base.UUID=1),"SUKI_"+a.Base.UUID++},b}(),a.Event=function(b){function e(){return c=e.__super__.constructor.apply(this,arguments)}return f(e,b),e.prototype.trigger=function(){var b,c,e,f=this;return c=arguments[0],b=2<=arguments.length?d.call(arguments,1):[],null!=(e=a.Event._handlers[c])?e.filter(function(a){return a.caller===f}).forEach(function(a){var c;return(c=a.handler).call.apply(c,[a.caller].concat(d.call(b)))}):void 0},e.prototype.bind=function(b,c){return a.Event._handlers[b]||(a.Event._handlers[b]=[]),a.Event._handlers[b].push({caller:this,handler:c})},e.prototype.unbind=function(){return a.Event._handlers=a._handlers.filter(function(a){return a.caller!==this})},e.prototype.once=function(a,b){var c;return c=function(){var e;return e=1<=arguments.length?d.call(arguments,0):[],this.unbind(a,c),b.call.apply(b,[this].concat(d.call(e)))},this.bind(a,c)},e._handlers=[],e.triggerAll=function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?d.call(arguments,1):[],null!=(c=e._handlers[b])?c.forEach(function(b){var c;return(c=b.handler).call.apply(c,[b.caller].concat(d.call(a)))}):void 0},e}.call(this,a.Base),a.Timer=function(b){function c(b,c,d,e){var f,g=this;null==e&&(e=!0),this.meta={beginTime:Date.now(),count:0,repeat:d},f=function(){var d;return e&&a.Timer.requestAnimationFrame?(d=function(){var e,f,h;for(f=g.meta.count*c,h=Date.now()-f-g.meta.beginTime,e=Math.floor(h/c);e&&g.meta.repeat;)b(),++g.meta.count,--g.meta.repeat,--e;return g.meta.repeat?a.Timer.requestAnimationFrame.call(window,d):void 0})():g.timer=setInterval(function(){return g.meta.repeat&&!g.paused?(b(),--g.meta.repeat):clearInterval(g.timer)})},this.bind("Pause",function(){return this.paused=!0}),this.bind("Unpause",function(){return this.paused=!0}),f()}return f(c,b),c.include(a.Event),c.prototype.delay=function(b,c){return new a.Timer(b,c,1)},c.prototype.destructor=function(){return this.unbind("Unpause"),this.unbind("Pause"),this.paused=!0},c.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,c}(a.Base),a.Entity=function(b){function c(){var b,c,e;if(e=arguments[0],b=2<=arguments.length?d.call(arguments,1):[],c=a.Entity.definitions[e],!c)throw new Error("Component '"+e+"' must be defined before create.");this.id=this.UUID(),this.style={},c.call.apply(c,[this].concat(d.call(b))),a.trigger("NewEntity",this)}var g;return f(c,b),c.include(a.Timer),c.prototype.attr=function(a,b){var c,d;c=a,"string"==typeof a&&(c={},c[a]=b),d=[];for(a in c)e.call(c,a)&&(b=c[a],d.push(this[attr]=b));return d},c.prototype.include=function(){var b,c,e;if(e=arguments[0],b=2<=arguments.length?d.call(arguments,1):[],c=a.Entity.definitions[e],!c)throw new Error("Component '"+e+"' must be defined before create.");return c.call.apply(c,[this].concat(d.call(b)))},c.prototype.css=function(a,b){return void 0===b?this.style[a]:(this.style[a]=b,this._dirty=!0)},c.definitions={},c.define=function(a,b){return this.definitions[a]=b},g=["width","height","x","y"],g.forEach(function(a){return c.getter(a,function(){return this["_"+a]}),c.setter(a,function(b){return b=Math.round(b),this[a]!==b&&(this._dirty=!0),this["_"+a]=b})}),c}.call(this,a.Base),a.Scene=function(b){function c(){var b,c,e;if(c=arguments[0],b=2<=arguments.length?d.call(arguments,1):[],e=a.Scene.definitions[c],this._constructor=e._constructor,this._destructor=e._destructor,!constructor)throw new Error("Scene '"+c+"' must be defined before create.");this._entities=[],this.bind("NewEntity",function(b){return console.log(b),a.Scene.current===this?this._entities.push(b):void 0})}return f(c,b),c.include(a.Timer),c.include(a.Event),c.prototype.start=function(){var b,c=this;return b=1<=arguments.length?d.call(arguments,0):[],setTimeout(function(){return a.Scene.current=c,c._constructor.apply(c,b),c.frameTimer=new a.Timer(function(){return c.enterFrame()},20,1/0),c.bind("AfterDraw",function(){return this._entities.forEach(function(a){return a._dirty=!1})})},0)},c.prototype.enterFrame=function(){return a.trigger("EnterFrame"),a.trigger("BeforeDraw",this._entities)},c.definitions={},c.define=function(a,b,c){return this.definitions[a]={_constructor:b,_destructor:c}},Object.defineProperty(c,"current",{get:function(){if(!this._current)throw new Error("Entities must be created inside a scene.");return this._current},set:function(b){return a.trigger("BeforeSceneChange",this._current,b),this._current&&(this._current.trigger("beforeSceneDestory"),this._current.destory()),this._current=b}}),c}(a.Base),a.Stage=function(b){function c(b,c,d){var f,g,h=this;if(null==b&&(b=926.4),null==c&&(c=246.4),"string"==typeof d&&(d=document.getElementById(element),!d))throw new Error("Could't find the element by id "+d);if(d){if(f=HTMLElement||Element,!(d instanceof f))throw new TypeError("`canvas` must be a string or an HTMLElement")}else d=document.createElement("div"),d.id=this.UUID(),document.body.appendChild(d);g=this.canvas={dom:d,scale:{},scroll:{}},["x","y"].forEach(function(a){return Object.defineProperty(h.canvas.scale,a,{get:function(){return this["_"+a]},set:function(b){return g._dirty=g._deepDirty=!0,this["_"+a]=b}})}),["x","y"].forEach(function(a){return Object.defineProperty(h.canvas.scroll,a,{get:function(){return this["_"+a]},set:function(b){return g._dirty=!0,this["_"+a]=b}})}),["width","height"].forEach(function(a){return Object.defineProperty(h.canvas,a,{get:function(){return this["_"+a]},set:function(b){return this._dirty=!0,this["_"+a]=b}})}),this.canvas.scale.x=1,this.canvas.scale.y=1,this.canvas.scroll.x=0,this.canvas.scroll.y=0,this.canvas.width=b,this.canvas.height=c,this.bind("BeforeDraw",function(b){var c=this;return this.canvas._dirty&&(this.canvas.dom.style.left+=""+this.canvas.scroll.x+"px",this.canvas.dom.style.top+=""+this.canvas.scroll.y+"px",this.canvas.dom.style.width=""+this.canvas.width*this.canvas.scale.x+"px",this.canvas.dom.style.height=""+this.canvas.height*this.canvas.scale.y+"px",this.canvas._dirty=!1),b.forEach(function(a){var b,d,f,g,h;if(c.canvas._deepDirty||a._dirty){b=document.getElementById(a.id),b||(b=document.createElement("div"),b.id=a.id,b.style.position="absolute",c.canvas.dom.appendChild(b)),b.style.left=""+a.x*c.canvas.scale.x+"px",b.style.top=""+a.y*c.canvas.scale.y+"px",b.style.width=""+a.width*c.canvas.scale.x+"px",b.style.height=""+a.height*c.canvas.scale.y+"px",g=a.style,h=[];for(d in g)e.call(g,d)&&(f=g[d],h.push(b.style[d]=f));return h}}),this.canvas._deepDirty=!1,a.trigger("AfterDraw",b)})}return f(c,b),c.include(a.Event),c}(a.Base),a.util={extend:function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a}}}).call(this);
//# sourceMappingURL=build/suki.min.js.map