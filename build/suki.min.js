(function(){var a,b,c=[].slice,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=window.Suki={},a.trigger=function(){var b,d;return b=1<=arguments.length?c.call(arguments,0):[],(d=a.Event).triggerAll.apply(d,b)},Object.defineProperty(a,"stage",{get:function(){return a._stage||(a._stage=new a.Stage),a._stage}}),a.Base=function(){function b(){}return b.include=function(a){var b,c,e,f;e=a.prototype;for(b in e)d.call(e,b)&&(c=e[b],"constructor"!==b&&(this.prototype[b]=c));return null!=(f=a.included)?f.apply(this):void 0},b.getter=function(a,b){return Object.defineProperty(this.prototype,a,{get:b,configurable:!0})},b.setter=function(a,b){return Object.defineProperty(this.prototype,a,{set:b,configurable:!0})},b.getter("id",function(){return this._UUID?this._UUID:(a.Base.UUID||(a.Base.UUID=1),this._UUID="SUKI_"+this.constructor.name+"_"+a.Base.UUID++)}),b}(),a.Event=function(f){function g(){return b=g.__super__.constructor.apply(this,arguments)}return e(g,f),g.prototype.trigger=function(){var b,d,e,f=this;return d=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],null!=(e=a.Event._handlers[d])&&e.filter(function(a){return a.caller===f}).forEach(function(a){var d;return(d=a.handler).call.apply(d,[a.caller].concat(c.call(b)))}),this},g.prototype.bind=function(b,c){return a.Event._handlers[b]||(a.Event._handlers[b]=[]),a.Event._handlers[b].push({caller:this,handler:c}),this},g.prototype.unbind=function(b,c){var e,f,g,h,i,j,k;j=a.Event._handlers;for(g in j)if(d.call(j,g)&&(h=j[g],!b||b===g)){for(e=i=k=h.length-1;i>=0;e=i+=-1)f=h[e],f.caller===this&&(c&&c!==f.handler||h.splice(e,1));a.Event._handlers[g].length||delete a.Event._handlers[g]}return this},g.prototype.one=function(a,b){var d;return d=function(){var e;return e=1<=arguments.length?c.call(arguments,0):[],this.unbind(a,d),b.call.apply(b,[this].concat(c.call(e)))},this.bind(a,d),this},g._handlers={},g.triggerAll=function(){var a,b,d;return b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],d=0,g._handlers[b]&&g._handlers[b].forEach(function(b){var e;return d+=1,(e=b.handler).call.apply(e,[b.caller].concat(c.call(a)))}),d},g}.call(this,a.Base),a.Timer=function(b){function c(b,c,d,e){var f,g=this;null==e&&(e=!0),this.meta={beginTime:Date.now(),count:0,repeat:d},f=function(){var d;return e&&a.Timer.requestAnimationFrame?(d=function(){var e,f,h;for(f=g.meta.count*c,h=Date.now()-f-g.meta.beginTime,e=Math.floor(h/c);e&&g.meta.repeat;)b(),++g.meta.count,--g.meta.repeat,--e;return g.meta.repeat?a.Timer.requestAnimationFrame.call(window,d):void 0})():g.timer=setInterval(function(){return g.meta.repeat&&!g.paused?(b(),--g.meta.repeat):clearInterval(g.timer)})},this.bind("Pause",function(){return this.paused=!0}),this.bind("Unpause",function(){return this.paused=!0}),f()}return e(c,b),c.include(a.Event),c.prototype.delay=function(b,c){return new a.Timer(b,c,1)},c.prototype.destroy=function(){return this.unbind("Unpause"),this.unbind("Pause"),this.paused=!0},c.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,c}(a.Base),a.Entity=function(b){function f(){var b,d,e,f;if(d=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],this.type=d,!a.Entity.definitions[this.type])throw new Error("Entity '"+this.type+"' must be defined before created.");e=a.Entity.definitions[this.type],this._constructor=e._constructor,this._destructor=e._destructor,this.style={},this.speed={x:0,y:0},this._included={},(f=this._constructor).call.apply(f,[this].concat(c.call(b))),this.layer=a.Layer.current,a.trigger("CreateEntity",this),this.bind("BeforeDraw",function(){var a;return a={x:this.speed.x,y:this.speed.y},(this.speed.x||this.speed.y)&&this.trigger("beforeMove",a),this.x+=a.x,this.y+=a.y})}var g;return e(f,b),f.include(a.Timer),f.prototype.attr=function(a,b){var c,e;if(c=a,"string"==typeof a){if("undefined"==typeof b)return this[a];c={},c[a]=b}e=[];for(a in c)d.call(c,a)&&(b=c[a],e.push(this[a]=b));return e},f.prototype.include=function(){var b,d,e,f,g;if(d=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],!a.Entity.definitions[d])throw new Error("Entity '"+d+"' must be defined before created.");return g=a.Entity.definitions[d],e=g._constructor,f=g._destructor,e.call.apply(e,[this].concat(c.call(b))),this._included[d]=f,this},f.prototype.is=function(a){return Boolean(this.type===a||this._included[a])},f.prototype.css=function(a,b){return void 0===b?this.style[a]:this.style[a]!==b?(this.style[a]=b,this.dirty=!0):void 0},f.prototype.destroy=function(){var b,e,f,g;b=1<=arguments.length?c.call(arguments,0):[],delete this.scene,g=this._included;for(f in g)d.call(g,f)&&(e=g[f],e.call.apply(e,[this].concat(c.call(b))));return a.trigger("DestroyEntity",this),this.unbind(),"function"==typeof this._destructor?this._destructor.apply(this,b):void 0},f.definitions={},f.define=function(a,b,c){return this.definitions[a]={_constructor:b||function(){},_destructor:c||function(){}},this},f.create=function(){var a,b;return b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(this,[b].concat(c.call(a)),function(){})},g=["width","height","x","y"],g.forEach(function(a){return f.getter(a,function(){return this["_"+a]}),f.setter(a,function(b){return b=Math.round(b),this[a]!==b?(this.dirty=!0,this["_"+a]=b):void 0})}),f}.call(this,a.Base),a.Layer=function(b){function d(){var b,d,e;if(d=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],this.type=d,!a.Layer.definitions[this.type])throw new Error("Layer '"+this.type+"' must be defined before created.");e=a.Layer.definitions[this.type],this._constructor=e._constructor,this._destructor=e._destructor,this.bind("CreateEntity",function(b){return a.Layer.current===this?this.entities.push(b):void 0}),this.bind("DestroyEntity",function(a){var b;return b=this.entities.indexOf(a),-1!==b?this.entities.splice(b,1):void 0}),a.Layer.current=this,this.entities=[],this._constructor.apply(this,b),this.scene=a.Scene.current,a.trigger("CreateLayer",this)}return e(d,b),d.include(a.Timer),d.include(a.Event),d.prototype.destroy=function(){var b,d,e,f,g;for(b=1<=arguments.length?c.call(arguments,0):[],delete this.scene,g=this.entities,e=0,f=g.length;f>e;e++)d=g[e],d.destroy();return this.entities=[],a.trigger("DestroyLayer",this),this.unbind(),"function"==typeof this._destructor?this._destructor.apply(this,b):void 0},d.definitions={},d.define=function(a,b,c){return this.definitions[a]={_constructor:b||function(){},_destructor:c},this},d.create=function(){var a,b;return b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(this,[b].concat(c.call(a)),function(){})},Object.defineProperty(d,"current",{get:function(){return this._current||this.create(this._defaultLayerType),this._current},set:function(a){return this._current=a}}),d.clear=function(){return this.definitions={}},d._defaultLayerType="SUKI_DEFAULT_LAYER",d.define(d._defaultLayerType),d}(a.Base),a.Scene=function(b){function d(){var b,d,e,f=this;if(d=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],this.type=d,!a.Scene.definitions[this.type])throw new Error("Scene '"+this.type+"' must be defined before created.");e=a.Scene.definitions[this.type],this._constructor=e._constructor,this._destructor=e._destructor,this.bind("CreateLayer",function(b){return a.Scene.current===this?this.layers.push(b):void 0}),this.bind("DestroyLayer",function(a){var b;return b=this.layers.indexOf(a),-1!==b?this.layers.splice(b,1):void 0}),this.layers=[],a.Scene.current=this,this._constructor.apply(this,b),a.trigger("CreateScene",this),this.frameTimer=new a.Timer(function(){return f.enterFrame()},16,1/0)}return e(d,b),d.include(a.Timer),d.include(a.Event),d.prototype.destroy=function(){var b,d,e,f,g;for(b=1<=arguments.length?c.call(arguments,0):[],this.frameTimer.destroy(),g=this.layers,e=0,f=g.length;f>e;e++)d=g[e],d.destroy();return this.layers=[],a.trigger("DestroyScene",this),this.unbind(),"function"==typeof this._destructor?this._destructor.apply(this,b):void 0},d.prototype.enterFrame=function(){var b,c,d,e;for(a.trigger("EnterFrame"),a.trigger("BeforeDraw"),e=this.layers,c=0,d=e.length;d>c;c++)b=e[c],a.trigger("DrawLayer",b);return a.trigger("DrawCamera"),a.trigger("AfterDraw")},d.definitions={},d.define=function(a,b,c){return this.definitions[a]={_constructor:b||function(){},_destructor:c||function(){}},this},d.create=function(){var a,b;return b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(this,[b].concat(c.call(a)),function(){})},Object.defineProperty(d,"current",{get:function(){return this._current||this.create(this._defaultSceneType),this._current},set:function(a){return this._current&&this._current.destroy(),this._current=a}}),d.clear=function(){return this.definitions={}},d._defaultSceneType="SUKI_DEFAULT_SCENE",d.define(d._defaultSceneType),d}(a.Base),a.Stage=function(b){function c(b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q;if(null==b&&(b=926.4),null==c&&(c=246.4),"string"==typeof e&&(e=document.getElementById(element),!e))throw new Error("Could't find the element by id "+e);if(e){if(f=HTMLElement||Element,!(e instanceof f))throw new TypeError("`camera` must be a string or an HTMLElement")}else e=document.createElement("div"),e.id=this.id,document.body.appendChild(e);for(g=this.camera={dom:e,scale:{},scroll:{}},o=["x","y"],i=0,l=o.length;l>i;i++)h=o[i],Object.defineProperty(this.camera.scale,h,{get:function(){return this["_"+h]},set:function(b){var c,d,e,f;for(g.dirty=!0,f=a.Scene.current.layers,d=0,e=f.length;e>d;d++)c=f[d],c.deepDirty=!0;return this["_"+h]=b}});for(p=["x","y"],j=0,m=p.length;m>j;j++)h=p[j],Object.defineProperty(this.camera.scroll,h,{get:function(){return this["_"+h]},set:function(b){var c,d,e,f;for(g.dirty=!0,f=a.Scene.current.layers,d=0,e=f.length;e>d;d++)c=f[d],c.dirty=!0;return this["_"+h]=b}});for(q=["width","height"],k=0,n=q.length;n>k;k++)h=q[k],Object.defineProperty(this.camera,h,{get:function(){return this["_"+h]},set:function(a){return this.dirty=!0,this["_"+h]=a}});this.camera.scale.x=1,this.camera.scale.y=1,this.camera.scroll.x=0,this.camera.scroll.y=0,this.camera.width=b,this.camera.height=c,this.bind("DrawCamera",function(){return this.camera.dirty?(this.camera.dom.style.width=""+this.camera.width*this.camera.scale.x+"px",this.camera.dom.style.height=""+this.camera.height*this.camera.scale.y+"px",this.camera.dirty=!1):void 0}),this.bind("DrawLayer",function(a){var b,c,e,f,g,h,i,j,k,l;for(a.dirty&&(f=document.getElementById(a.id),g={x:this.camera.scroll.x,y:this.camera.scroll.y},a.trigger("scroll",g),f.style.left=-(""+g.x+"px"),f.style.top=-(""+g.y+"px"),a.dirty=!1),k=a.entities,i=0,j=k.length;j>i;i++)if(c=k[i],a.deepDirty||c.dirty){b=document.getElementById(c.id),b.style.left=""+c.x*this.camera.scale.x+"px",b.style.top=""+c.y*this.camera.scale.y+"px",b.style.width=""+c.width*this.camera.scale.x+"px",b.style.height=""+c.height*this.camera.scale.y+"px",l=c.style;for(e in l)d.call(l,e)&&(h=l[e],b.style[e]=h);c.dirty=!1}return a.deepDirty=!1}),this.bind("CreateEntity",function(a){var b,c;return b=document.createElement("div"),b.id=a.id,b.style.position="absolute",c=document.getElementById(a.layer.id),c.appendChild(b)}),this.bind("CreateLayer",function(a){var b;return b=document.createElement("div"),b.id=a.id,b.style.position="absolute",b.style.left="0",b.style.top="0",b.style.width="100%",b.style.height="100%",b.style.overflow="hidden",this.camera.dom.appendChild(b)})}return e(c,b),c.include(a.Event),c.prototype.clear=function(){return this.camera.innerHTML=""},c.prototype.removeEntity=function(a){var b;return b=document.getElementById(a.id),b?this.camera.dom.removeClild(b):void 0},c.prototype.removeLayer=function(a){var b;return b=document.getElementById(a.id),this.camera.dom.removeClild(b)},c}(a.Base),a.Vector=function(b){function d(){var b,d;if(d=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],this.type=d,this.type===a.Vector.CIRCLE)this.center=[b[0][0],b[0][1]],this.radius=b[1];else{if(this.type!==a.Vector.POLYGON)throw new Error("`type` must be either `Suki.Vector.CIRCLE` or `Suki.Vector.POLYGON`");this.points=b}}return e(d,b),d.prototype.collided=function(b){var c,d,e,f,g;return this.type===a.Vector.CIRCLE&&b.type===a.Vector.CIRCLE?(e=this.radius+b.radius,f=this.center[0]-b.center[0],g=this.center[1]-b.center[1],c=Math.sqrt(f*f+g*g),e>c):this.type===a.Vector.POLYGON&&b.type===a.Vector.POLYGON?(d=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(u=a.points,e=o=0,r=u.length;r>o;e=++o){for(c=u[e],l=a.points[e===a.points.length-1?0:e+1],m=[c[1]-l[1],l[0]-c[0]],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]),m[0]/=g,m[1]/=g,j=k=1/0,h=i=-1/0,v=a.points,p=0,s=v.length;s>p;p++)n=v[p],d=n[0]*m[0]+n[1]*m[1],d>h&&(h=d),j>d&&(j=d);for(w=b.points,q=0,t=w.length;t>q;q++)n=w[q],d=n[0]*m[0]+n[1]*m[1],d>i&&(i=d),k>d&&(k=d);if(f=k>j?k-h:j-i,!(0>f))return!0}},!d(this,b)&&!d(b,this)):void 0},d.CIRCLE="c",d.POLYGON="p",d.prototype.duplicate=function(){return this.type===a.Vector.CIRCLE?new a.Vector(this.type,this.center,this.radius):function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(a.Vector,[this.type].concat(c.call(this.points)),function(){})},d.prototype.relative=function(b,c){var d,e,f,g,h,i;if(e=this.duplicate(),this.type===a.Vector.CIRCLE)e.center=[e.center[0]+b,e.center[1]+c];else for(i=e.points,d=g=0,h=i.length;h>g;d=++g)f=i[d],e.points[d]=[f[0]+b,f[1]+c];return e},d.prototype.rotate=function(b,c){var d,e,f,g,h,i;if(e=this.duplicate(),this.type===a.Vector.CIRCLE)e.center=a.Vector.rotatePoint(e.center,b,c);else for(i=e.points,d=g=0,h=i.length;h>g;d=++g)f=i[d],e.points[d]=a.Vector.rotatePoint(f,b,c);return e},d.rotatePoint=function(a,b){return[Math.round(a[0]*Math.cos(b*Math.PI/180)-a[1]*Math.sin(b*Math.PI/180)),Math.round(a[0]*Math.sin(b*Math.PI/180)+a[1]*Math.cos(b*Math.PI/180))]},d}(a.Base),a.Entity.define("Circle",function(){return this.css("borderRadius","99999px")}),a.Entity.define("Collision",function(){return this.collision=function(a,b){return this.collision.boundary=a,this.collision.collisionMap=b},this.bind("beforeMove",function(a){var b,c,d,e,f,g=this;return d={top:this.y,left:this.x},e={x:a.x,y:a.y},this.x+=a.x,this.y+=a.y,b=this.layer.entities.filter(function(a){return a.is("Collision")&&a!==g}),"object"==typeof this.collision.collisionMap&&(c=Object.keys(_collisionMap),b=b.filter(function(a){return c.some(function(b){return a.is(b)})})),f={},Math.abs(a.x)>Math.abs(a.y)?(f.x=a.x/(a.y?Math.abs(a.y):Math.abs(a.x)),f.y=a.y?a.y/Math.abs(a.y):0):(f.x=a.x?a.x/Math.abs(a.x):0,f.y=a.y/(a.x?Math.abs(a.x):Math.abs(a.y))),b.some(function(b){var c,h;for(h=0,c=!1;b.collision.boundary.relative(b.x,b.y).collided(g.collision.boundary.relative(g.x,g.y))&&(console.log(b.id,a),console.log(b.id,"sc",f),0!==a.x||0!==a.y);)c=!0,h+=1,a.x=Math.round(e.x-h*f.x),a.y=Math.round(e.y-h*f.y),g.y=d.top+a.y,g.x=d.left+a.x;return c?(a.x=e.x,a.y=e.y,g.x=d.left,g.y=d.top,g.trigger("hit",b,{currentSpeed:a,x:h*f.x,y:h*f.y}),!0):void 0})})}),a.Entity.define("Color",function(a){return this.color=function(a){return this.css("backgroundColor",a)},a?this.color(a):void 0}),a.Entity.define("Pixel",function(a){var b,c;return this.include("Image"),this.img=a,img.src=a,b=document.createElement("canvas"),c=b.getContext("2d"),c.drawImage(img,0,0),c.getImageData(x,y,1,1).data}),a.Entity.define("Rotate",function(a){var b,c;return this.include("Image"),this.img=a,img.src=a,b=document.createElement("canvas"),c=b.getContext("2d"),c.drawImage(img,0,0),c.getImageData(x,y,1,1).data}),a.Entity.define("Sprite",function(a,b,c,d,e,f,g){return this.width=f,this.height=g,this.css("backgroundImage","url("+a+")"),this.css("backgroundPosition","-"+d+"px -"+e+"px")})}).call(this);
//# sourceMappingURL=build/suki.min.js.map